

<!DOCTYPE html>
<html class="writer-html5" lang="en" data-content_root="../">
<head>
  <meta charset="utf-8" /><meta name="viewport" content="width=device-width, initial-scale=1" />

  <meta name="viewport" content="width=device-width, initial-scale=1.0" />
  <title>Advanced Usage &mdash; SignXAI 1.0.0 documentation</title>
      <link rel="stylesheet" type="text/css" href="../_static/pygments.css?v=fa44fd50" />
      <link rel="stylesheet" type="text/css" href="../_static/css/theme.css?v=e59714d7" />
      <link rel="stylesheet" type="text/css" href="../_static/custom.css?v=ec77c5b5" />

  
      <script src="../_static/jquery.js?v=5d32c60e"></script>
      <script src="../_static/_sphinx_javascript_frameworks_compat.js?v=2cd50e6c"></script>
      <script src="../_static/documentation_options.js?v=8d563738"></script>
      <script src="../_static/doctools.js?v=9bcbadda"></script>
      <script src="../_static/sphinx_highlight.js?v=dc90522c"></script>
      <script crossorigin="anonymous" integrity="sha256-Ae2Vz/4ePdIu6ZyI/5ZGsYnb+m0JlOmKPjt6XZ9JJkA=" src="https://cdnjs.cloudflare.com/ajax/libs/require.js/2.3.4/require.min.js"></script>
    <script src="../_static/js/theme.js"></script>
    <link rel="index" title="Index" href="../genindex.html" />
    <link rel="search" title="Search" href="../search.html" />
    <link rel="next" title="Visualization" href="visualization.html" />
    <link rel="prev" title="Framework Interoperability" href="framework_interop.html" /> 
</head>

<body class="wy-body-for-nav"> 
  <div class="wy-grid-for-nav">
    <nav data-toggle="wy-nav-shift" class="wy-nav-side">
      <div class="wy-side-scroll">
        <div class="wy-side-nav-search"  style="background: #2980B9" >

          
          
          <a href="../index.html" class="icon icon-home">
            SignXAI
          </a>
<div role="search">
  <form id="rtd-search-form" class="wy-form" action="../search.html" method="get">
    <input type="text" name="q" placeholder="Search docs" aria-label="Search docs" />
    <input type="hidden" name="check_keywords" value="yes" />
    <input type="hidden" name="area" value="default" />
  </form>
</div>
        </div><div class="wy-menu wy-menu-vertical" data-spy="affix" role="navigation" aria-label="Navigation menu">
              <p class="caption" role="heading"><span class="caption-text">Getting Started</span></p>
<ul>
<li class="toctree-l1"><a class="reference internal" href="installation.html">Installation</a></li>
<li class="toctree-l1"><a class="reference internal" href="quickstart.html">Quickstart</a></li>
<li class="toctree-l1"><a class="reference internal" href="basic_usage.html">Basic Usage</a></li>
</ul>
<p class="caption" role="heading"><span class="caption-text">User Guide</span></p>
<ul class="current">
<li class="toctree-l1"><a class="reference internal" href="framework_interop.html">Framework Interoperability</a></li>
<li class="toctree-l1 current"><a class="current reference internal" href="#">Advanced Usage</a><ul>
<li class="toctree-l2"><a class="reference internal" href="#advanced-lrp-configuration">Advanced LRP Configuration</a><ul>
<li class="toctree-l3"><a class="reference internal" href="#tensorflow-advanced-lrp">TensorFlow Advanced LRP</a></li>
<li class="toctree-l3"><a class="reference internal" href="#pytorch-advanced-lrp">PyTorch Advanced LRP</a></li>
</ul>
</li>
<li class="toctree-l2"><a class="reference internal" href="#custom-target-class-selection">Custom Target Class Selection</a><ul>
<li class="toctree-l3"><a class="reference internal" href="#tensorflow-custom-target">TensorFlow Custom Target</a></li>
<li class="toctree-l3"><a class="reference internal" href="#pytorch-custom-target">PyTorch Custom Target</a></li>
</ul>
</li>
<li class="toctree-l2"><a class="reference internal" href="#working-with-time-series-data">Working with Time Series Data</a><ul>
<li class="toctree-l3"><a class="reference internal" href="#tensorflow-time-series">TensorFlow Time Series</a></li>
<li class="toctree-l3"><a class="reference internal" href="#pytorch-time-series">PyTorch Time Series</a></li>
</ul>
</li>
<li class="toctree-l2"><a class="reference internal" href="#custom-sign-methods">Custom SIGN Methods</a><ul>
<li class="toctree-l3"><a class="reference internal" href="#tensorflow-sign">TensorFlow SIGN</a></li>
<li class="toctree-l3"><a class="reference internal" href="#pytorch-sign">PyTorch SIGN</a></li>
</ul>
</li>
<li class="toctree-l2"><a class="reference internal" href="#integrating-with-other-libraries">Integrating with Other Libraries</a><ul>
<li class="toctree-l3"><a class="reference internal" href="#shap-integration">SHAP Integration</a></li>
<li class="toctree-l3"><a class="reference internal" href="#captum-integration">Captum Integration</a></li>
</ul>
</li>
<li class="toctree-l2"><a class="reference internal" href="#advanced-visualization-techniques">Advanced Visualization Techniques</a><ul>
<li class="toctree-l3"><a class="reference internal" href="#overlay-with-transparency">Overlay with Transparency</a></li>
<li class="toctree-l3"><a class="reference internal" href="#positive-and-negative-contributions">Positive and Negative Contributions</a></li>
</ul>
</li>
<li class="toctree-l2"><a class="reference internal" href="#performance-optimization">Performance Optimization</a><ul>
<li class="toctree-l3"><a class="reference internal" href="#tensorflow-performance">TensorFlow Performance</a></li>
<li class="toctree-l3"><a class="reference internal" href="#pytorch-performance">PyTorch Performance</a></li>
</ul>
</li>
<li class="toctree-l2"><a class="reference internal" href="#next-steps">Next Steps</a></li>
</ul>
</li>
<li class="toctree-l1"><a class="reference internal" href="visualization.html">Visualization</a></li>
<li class="toctree-l1"><a class="reference internal" href="tensorflow.html">TensorFlow Implementation</a></li>
<li class="toctree-l1"><a class="reference internal" href="pytorch.html">PyTorch Implementation</a></li>
</ul>
<p class="caption" role="heading"><span class="caption-text">Tutorials</span></p>
<ul>
<li class="toctree-l1"><a class="reference internal" href="../tutorials/image_classification.html">Image Classification</a></li>
<li class="toctree-l1"><a class="reference internal" href="../tutorials/time_series.html">ECG Time Series</a></li>
</ul>
<p class="caption" role="heading"><span class="caption-text">API Reference</span></p>
<ul>
<li class="toctree-l1"><a class="reference internal" href="../api/tensorflow.html">TensorFlow Module</a></li>
<li class="toctree-l1"><a class="reference internal" href="../api/pytorch.html">PyTorch Module</a></li>
<li class="toctree-l1"><a class="reference internal" href="../api/common.html">Common Module</a></li>
<li class="toctree-l1"><a class="reference internal" href="../api/utils.html">Utilities</a></li>
<li class="toctree-l1"><a class="reference internal" href="../api/methods_list.html">Explanation Methods List</a></li>
</ul>

        </div>
      </div>
    </nav>

    <section data-toggle="wy-nav-shift" class="wy-nav-content-wrap"><nav class="wy-nav-top" aria-label="Mobile navigation menu"  style="background: #2980B9" >
          <i data-toggle="wy-nav-top" class="fa fa-bars"></i>
          <a href="../index.html">SignXAI</a>
      </nav>

      <div class="wy-nav-content">
        <div class="rst-content">
          <div role="navigation" aria-label="Page navigation">
  <ul class="wy-breadcrumbs">
      <li><a href="../index.html" class="icon icon-home" aria-label="Home"></a></li>
      <li class="breadcrumb-item active">Advanced Usage</li>
      <li class="wy-breadcrumbs-aside">
              <a href="https://github.com/signxai/signxai/blob/main/docs/guide/advanced_usage.rst" class="fa fa-github"> Edit on GitHub</a>
      </li>
  </ul>
  <hr/>
</div>
          <div role="main" class="document" itemscope="itemscope" itemtype="http://schema.org/Article">
           <div itemprop="articleBody">
             
  <section id="advanced-usage">
<h1>Advanced Usage<a class="headerlink" href="#advanced-usage" title="Link to this heading">ÔÉÅ</a></h1>
<p>This guide covers advanced usage patterns and features of SignXAI.</p>
<nav class="contents local" id="contents">
<p class="topic-title">Contents</p>
<ul class="simple">
<li><p><a class="reference internal" href="#advanced-lrp-configuration" id="id1">Advanced LRP Configuration</a></p>
<ul>
<li><p><a class="reference internal" href="#tensorflow-advanced-lrp" id="id2">TensorFlow Advanced LRP</a></p></li>
<li><p><a class="reference internal" href="#pytorch-advanced-lrp" id="id3">PyTorch Advanced LRP</a></p></li>
</ul>
</li>
<li><p><a class="reference internal" href="#custom-target-class-selection" id="id4">Custom Target Class Selection</a></p>
<ul>
<li><p><a class="reference internal" href="#tensorflow-custom-target" id="id5">TensorFlow Custom Target</a></p></li>
<li><p><a class="reference internal" href="#pytorch-custom-target" id="id6">PyTorch Custom Target</a></p></li>
</ul>
</li>
<li><p><a class="reference internal" href="#working-with-time-series-data" id="id7">Working with Time Series Data</a></p>
<ul>
<li><p><a class="reference internal" href="#tensorflow-time-series" id="id8">TensorFlow Time Series</a></p></li>
<li><p><a class="reference internal" href="#pytorch-time-series" id="id9">PyTorch Time Series</a></p></li>
</ul>
</li>
<li><p><a class="reference internal" href="#custom-sign-methods" id="id10">Custom SIGN Methods</a></p>
<ul>
<li><p><a class="reference internal" href="#tensorflow-sign" id="id11">TensorFlow SIGN</a></p></li>
<li><p><a class="reference internal" href="#pytorch-sign" id="id12">PyTorch SIGN</a></p></li>
</ul>
</li>
<li><p><a class="reference internal" href="#integrating-with-other-libraries" id="id13">Integrating with Other Libraries</a></p>
<ul>
<li><p><a class="reference internal" href="#shap-integration" id="id14">SHAP Integration</a></p></li>
<li><p><a class="reference internal" href="#captum-integration" id="id15">Captum Integration</a></p></li>
</ul>
</li>
<li><p><a class="reference internal" href="#advanced-visualization-techniques" id="id16">Advanced Visualization Techniques</a></p>
<ul>
<li><p><a class="reference internal" href="#overlay-with-transparency" id="id17">Overlay with Transparency</a></p></li>
<li><p><a class="reference internal" href="#positive-and-negative-contributions" id="id18">Positive and Negative Contributions</a></p></li>
</ul>
</li>
<li><p><a class="reference internal" href="#performance-optimization" id="id19">Performance Optimization</a></p>
<ul>
<li><p><a class="reference internal" href="#tensorflow-performance" id="id20">TensorFlow Performance</a></p></li>
<li><p><a class="reference internal" href="#pytorch-performance" id="id21">PyTorch Performance</a></p></li>
</ul>
</li>
<li><p><a class="reference internal" href="#next-steps" id="id22">Next Steps</a></p></li>
</ul>
</nav>
<section id="advanced-lrp-configuration">
<h2><a class="toc-backref" href="#id1" role="doc-backlink">Advanced LRP Configuration</a><a class="headerlink" href="#advanced-lrp-configuration" title="Link to this heading">ÔÉÅ</a></h2>
<p>Layer-wise Relevance Propagation (LRP) is highly configurable. Here‚Äôs how to use advanced settings:</p>
<section id="tensorflow-advanced-lrp">
<h3><a class="toc-backref" href="#id2" role="doc-backlink">TensorFlow Advanced LRP</a><a class="headerlink" href="#tensorflow-advanced-lrp" title="Link to this heading">ÔÉÅ</a></h3>
<div class="highlight-python notranslate"><div class="highlight"><pre><span></span><span class="kn">import</span> <span class="nn">numpy</span> <span class="k">as</span> <span class="nn">np</span>
<span class="kn">from</span> <span class="nn">tensorflow.keras.applications.vgg16</span> <span class="kn">import</span> <span class="n">VGG16</span>
<span class="kn">from</span> <span class="nn">signxai.utils.utils</span> <span class="kn">import</span> <span class="n">calculate_explanation_innvestigate</span>

<span class="c1"># Load model</span>
<span class="n">model</span> <span class="o">=</span> <span class="n">VGG16</span><span class="p">(</span><span class="n">weights</span><span class="o">=</span><span class="s1">&#39;imagenet&#39;</span><span class="p">)</span>
<span class="n">model</span><span class="o">.</span><span class="n">layers</span><span class="p">[</span><span class="o">-</span><span class="mi">1</span><span class="p">]</span><span class="o">.</span><span class="n">activation</span> <span class="o">=</span> <span class="kc">None</span>

<span class="c1"># Load and preprocess input</span>
<span class="c1"># ...</span>

<span class="c1"># Basic LRP-Z</span>
<span class="n">lrp_z</span> <span class="o">=</span> <span class="n">calculate_explanation_innvestigate</span><span class="p">(</span>
    <span class="n">model</span><span class="p">,</span>
    <span class="n">input_tensor</span><span class="p">,</span>
    <span class="n">method</span><span class="o">=</span><span class="s1">&#39;lrp.z&#39;</span>
<span class="p">)</span>

<span class="c1"># LRP-Z with SIGN input layer rule</span>
<span class="n">lrp_sign</span> <span class="o">=</span> <span class="n">calculate_explanation_innvestigate</span><span class="p">(</span>
    <span class="n">model</span><span class="p">,</span>
    <span class="n">input_tensor</span><span class="p">,</span>
    <span class="n">method</span><span class="o">=</span><span class="s1">&#39;lrp.z&#39;</span><span class="p">,</span>
    <span class="n">input_layer_rule</span><span class="o">=</span><span class="s1">&#39;SIGN&#39;</span>
<span class="p">)</span>

<span class="c1"># LRP-Epsilon with custom epsilon</span>
<span class="n">lrp_eps</span> <span class="o">=</span> <span class="n">calculate_explanation_innvestigate</span><span class="p">(</span>
    <span class="n">model</span><span class="p">,</span>
    <span class="n">input_tensor</span><span class="p">,</span>
    <span class="n">method</span><span class="o">=</span><span class="s1">&#39;lrp.epsilon&#39;</span><span class="p">,</span>
    <span class="n">epsilon</span><span class="o">=</span><span class="mf">0.01</span>
<span class="p">)</span>

<span class="c1"># LRP with bounded input range</span>
<span class="n">lrp_bounded</span> <span class="o">=</span> <span class="n">calculate_explanation_innvestigate</span><span class="p">(</span>
    <span class="n">model</span><span class="p">,</span>
    <span class="n">input_tensor</span><span class="p">,</span>
    <span class="n">method</span><span class="o">=</span><span class="s1">&#39;lrp.z&#39;</span><span class="p">,</span>
    <span class="n">input_layer_rule</span><span class="o">=</span><span class="s1">&#39;Bounded&#39;</span><span class="p">,</span>
    <span class="n">low</span><span class="o">=-</span><span class="mf">123.68</span><span class="p">,</span>  <span class="c1"># ImageNet mean values</span>
    <span class="n">high</span><span class="o">=</span><span class="mf">151.061</span>
<span class="p">)</span>

<span class="c1"># LRP-AlphaBeta with custom parameters</span>
<span class="n">lrp_alphabeta</span> <span class="o">=</span> <span class="n">calculate_explanation_innvestigate</span><span class="p">(</span>
    <span class="n">model</span><span class="p">,</span>
    <span class="n">input_tensor</span><span class="p">,</span>
    <span class="n">method</span><span class="o">=</span><span class="s1">&#39;lrp.alpha_beta&#39;</span><span class="p">,</span>
    <span class="n">alpha</span><span class="o">=</span><span class="mi">2</span><span class="p">,</span>
    <span class="n">beta</span><span class="o">=</span><span class="mi">1</span>
<span class="p">)</span>

<span class="c1"># LRP Sequential Composite - different rules for different layers</span>
<span class="n">lrp_composite</span> <span class="o">=</span> <span class="n">calculate_explanation_innvestigate</span><span class="p">(</span>
    <span class="n">model</span><span class="p">,</span>
    <span class="n">input_tensor</span><span class="p">,</span>
    <span class="n">method</span><span class="o">=</span><span class="s1">&#39;lrp.sequential_composite_a&#39;</span>
<span class="p">)</span>
</pre></div>
</div>
</section>
<section id="pytorch-advanced-lrp">
<h3><a class="toc-backref" href="#id3" role="doc-backlink">PyTorch Advanced LRP</a><a class="headerlink" href="#pytorch-advanced-lrp" title="Link to this heading">ÔÉÅ</a></h3>
<div class="highlight-python notranslate"><div class="highlight"><pre><span></span><span class="kn">import</span> <span class="nn">torch</span>
<span class="kn">import</span> <span class="nn">torchvision.models</span> <span class="k">as</span> <span class="nn">models</span>
<span class="kn">from</span> <span class="nn">signxai.torch_signxai.methods.zennit_impl</span> <span class="kn">import</span> <span class="p">(</span>
    <span class="n">LRPAnalyzer</span><span class="p">,</span>
    <span class="n">AdvancedLRPAnalyzer</span><span class="p">,</span>
    <span class="n">LRPSequential</span>
<span class="p">)</span>
<span class="kn">from</span> <span class="nn">zennit.composites</span> <span class="kn">import</span> <span class="n">EpsilonPlusFlat</span><span class="p">,</span> <span class="n">LayerMapComposite</span>
<span class="kn">from</span> <span class="nn">zennit.rules</span> <span class="kn">import</span> <span class="n">Epsilon</span><span class="p">,</span> <span class="n">ZPlus</span><span class="p">,</span> <span class="n">ZBox</span><span class="p">,</span> <span class="n">Gamma</span>
<span class="kn">from</span> <span class="nn">zennit.types</span> <span class="kn">import</span> <span class="n">Convolution</span><span class="p">,</span> <span class="n">Linear</span>

<span class="c1"># Load model</span>
<span class="n">model</span> <span class="o">=</span> <span class="n">models</span><span class="o">.</span><span class="n">vgg16</span><span class="p">(</span><span class="n">pretrained</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span>
<span class="n">model</span><span class="o">.</span><span class="n">eval</span><span class="p">()</span>

<span class="c1"># Load and preprocess input</span>
<span class="c1"># ...</span>

<span class="c1"># Basic LRP-Epsilon</span>
<span class="n">analyzer_epsilon</span> <span class="o">=</span> <span class="n">LRPAnalyzer</span><span class="p">(</span><span class="n">model</span><span class="p">,</span> <span class="n">rule</span><span class="o">=</span><span class="s2">&quot;epsilon&quot;</span><span class="p">,</span> <span class="n">epsilon</span><span class="o">=</span><span class="mf">0.1</span><span class="p">)</span>
<span class="n">lrp_epsilon</span> <span class="o">=</span> <span class="n">analyzer_epsilon</span><span class="o">.</span><span class="n">analyze</span><span class="p">(</span><span class="n">input_tensor</span><span class="p">)</span>

<span class="c1"># LRP Alpha-Beta</span>
<span class="n">analyzer_alphabeta</span> <span class="o">=</span> <span class="n">LRPAnalyzer</span><span class="p">(</span><span class="n">model</span><span class="p">,</span> <span class="n">rule</span><span class="o">=</span><span class="s2">&quot;alphabeta&quot;</span><span class="p">)</span>  <span class="c1"># Default alpha=1, beta=0</span>
<span class="n">lrp_alphabeta</span> <span class="o">=</span> <span class="n">analyzer_alphabeta</span><span class="o">.</span><span class="n">analyze</span><span class="p">(</span><span class="n">input_tensor</span><span class="p">)</span>

<span class="c1"># Advanced: LRP with custom rules</span>
<span class="n">analyzer_advanced</span> <span class="o">=</span> <span class="n">AdvancedLRPAnalyzer</span><span class="p">(</span>
    <span class="n">model</span><span class="p">,</span>
    <span class="n">rule_type</span><span class="o">=</span><span class="s2">&quot;zbox&quot;</span><span class="p">,</span>
    <span class="n">low</span><span class="o">=-</span><span class="mf">123.68</span><span class="p">,</span>
    <span class="n">high</span><span class="o">=</span><span class="mf">151.061</span>
<span class="p">)</span>
<span class="n">lrp_advanced</span> <span class="o">=</span> <span class="n">analyzer_advanced</span><span class="o">.</span><span class="n">analyze</span><span class="p">(</span><span class="n">input_tensor</span><span class="p">)</span>

<span class="c1"># LRP Composite with layer-specific rules</span>
<span class="n">layer_map</span> <span class="o">=</span> <span class="p">{</span>
    <span class="n">Convolution</span><span class="p">:</span> <span class="n">ZPlus</span><span class="p">(),</span>         <span class="c1"># Use ZPlus for convolutional layers</span>
    <span class="n">Linear</span><span class="p">:</span> <span class="n">Epsilon</span><span class="p">(</span><span class="n">epsilon</span><span class="o">=</span><span class="mf">0.1</span><span class="p">)</span>  <span class="c1"># Use Epsilon for linear layers</span>
<span class="p">}</span>

<span class="c1"># Create a custom composite</span>
<span class="n">custom_composite</span> <span class="o">=</span> <span class="n">LayerMapComposite</span><span class="p">(</span><span class="n">layer_map</span><span class="p">)</span>

<span class="c1"># Use the custom composite</span>
<span class="n">analyzer_custom</span> <span class="o">=</span> <span class="n">AdvancedLRPAnalyzer</span><span class="p">(</span><span class="n">model</span><span class="p">,</span> <span class="n">rule_type</span><span class="o">=</span><span class="s2">&quot;custom&quot;</span><span class="p">,</span> <span class="n">composite</span><span class="o">=</span><span class="n">custom_composite</span><span class="p">)</span>
<span class="n">lrp_custom</span> <span class="o">=</span> <span class="n">analyzer_custom</span><span class="o">.</span><span class="n">analyze</span><span class="p">(</span><span class="n">input_tensor</span><span class="p">)</span>

<span class="c1"># LRP Sequential (layer-specialized composite)</span>
<span class="n">analyzer_sequential</span> <span class="o">=</span> <span class="n">LRPSequential</span><span class="p">(</span>
    <span class="n">model</span><span class="p">,</span>
    <span class="n">first_layer_rule</span><span class="o">=</span><span class="s2">&quot;zbox&quot;</span><span class="p">,</span>
    <span class="n">middle_layer_rule</span><span class="o">=</span><span class="s2">&quot;alphabeta&quot;</span><span class="p">,</span>
    <span class="n">last_layer_rule</span><span class="o">=</span><span class="s2">&quot;epsilon&quot;</span>
<span class="p">)</span>
<span class="n">lrp_sequential</span> <span class="o">=</span> <span class="n">analyzer_sequential</span><span class="o">.</span><span class="n">analyze</span><span class="p">(</span><span class="n">input_tensor</span><span class="p">)</span>
</pre></div>
</div>
</section>
</section>
<section id="custom-target-class-selection">
<h2><a class="toc-backref" href="#id4" role="doc-backlink">Custom Target Class Selection</a><a class="headerlink" href="#custom-target-class-selection" title="Link to this heading">ÔÉÅ</a></h2>
<p>By default, explanations target the class with the highest predicted probability, but you can specify any class:</p>
<section id="tensorflow-custom-target">
<h3><a class="toc-backref" href="#id5" role="doc-backlink">TensorFlow Custom Target</a><a class="headerlink" href="#tensorflow-custom-target" title="Link to this heading">ÔÉÅ</a></h3>
<div class="highlight-python notranslate"><div class="highlight"><pre><span></span><span class="c1"># Get predictions</span>
<span class="n">preds</span> <span class="o">=</span> <span class="n">model</span><span class="o">.</span><span class="n">predict</span><span class="p">(</span><span class="n">x</span><span class="p">)</span>

<span class="c1"># Get top 5 predicted classes</span>
<span class="n">top_classes</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">argsort</span><span class="p">(</span><span class="n">preds</span><span class="p">[</span><span class="mi">0</span><span class="p">])[</span><span class="o">-</span><span class="mi">5</span><span class="p">:][::</span><span class="o">-</span><span class="mi">1</span><span class="p">]</span>

<span class="c1"># Generate explanations for each class</span>
<span class="n">class_explanations</span> <span class="o">=</span> <span class="p">{}</span>
<span class="k">for</span> <span class="n">idx</span> <span class="ow">in</span> <span class="n">top_classes</span><span class="p">:</span>
    <span class="n">class_explanations</span><span class="p">[</span><span class="n">idx</span><span class="p">]</span> <span class="o">=</span> <span class="n">calculate_relevancemap</span><span class="p">(</span>
        <span class="s1">&#39;gradient_x_input&#39;</span><span class="p">,</span>
        <span class="n">x</span><span class="p">,</span>
        <span class="n">model</span><span class="p">,</span>
        <span class="n">neuron_selection</span><span class="o">=</span><span class="n">idx</span>  <span class="c1"># Specific class</span>
    <span class="p">)</span>

<span class="c1"># Visualize explanations for different classes</span>
<span class="n">fig</span><span class="p">,</span> <span class="n">axs</span> <span class="o">=</span> <span class="n">plt</span><span class="o">.</span><span class="n">subplots</span><span class="p">(</span><span class="mi">1</span><span class="p">,</span> <span class="nb">len</span><span class="p">(</span><span class="n">top_classes</span><span class="p">)</span> <span class="o">+</span> <span class="mi">1</span><span class="p">,</span> <span class="n">figsize</span><span class="o">=</span><span class="p">(</span><span class="mi">15</span><span class="p">,</span> <span class="mi">4</span><span class="p">))</span>

<span class="c1"># Original image</span>
<span class="n">axs</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span><span class="o">.</span><span class="n">imshow</span><span class="p">(</span><span class="n">img</span><span class="p">)</span>
<span class="n">axs</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span><span class="o">.</span><span class="n">set_title</span><span class="p">(</span><span class="s1">&#39;Original&#39;</span><span class="p">)</span>
<span class="n">axs</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span><span class="o">.</span><span class="n">axis</span><span class="p">(</span><span class="s1">&#39;off&#39;</span><span class="p">)</span>

<span class="c1"># Class-specific explanations</span>
<span class="k">for</span> <span class="n">i</span><span class="p">,</span> <span class="n">idx</span> <span class="ow">in</span> <span class="nb">enumerate</span><span class="p">(</span><span class="n">top_classes</span><span class="p">):</span>
    <span class="n">class_name</span> <span class="o">=</span> <span class="n">decode_predictions</span><span class="p">(</span><span class="n">preds</span><span class="p">,</span> <span class="n">top</span><span class="o">=</span><span class="mi">5</span><span class="p">)[</span><span class="mi">0</span><span class="p">][</span><span class="n">i</span><span class="p">][</span><span class="mi">1</span><span class="p">]</span>
    <span class="n">axs</span><span class="p">[</span><span class="n">i</span><span class="o">+</span><span class="mi">1</span><span class="p">]</span><span class="o">.</span><span class="n">imshow</span><span class="p">(</span><span class="n">normalize_heatmap</span><span class="p">(</span><span class="n">class_explanations</span><span class="p">[</span><span class="n">idx</span><span class="p">][</span><span class="mi">0</span><span class="p">]),</span> <span class="n">cmap</span><span class="o">=</span><span class="s1">&#39;seismic&#39;</span><span class="p">,</span> <span class="n">clim</span><span class="o">=</span><span class="p">(</span><span class="o">-</span><span class="mi">1</span><span class="p">,</span> <span class="mi">1</span><span class="p">))</span>
    <span class="n">axs</span><span class="p">[</span><span class="n">i</span><span class="o">+</span><span class="mi">1</span><span class="p">]</span><span class="o">.</span><span class="n">set_title</span><span class="p">(</span><span class="sa">f</span><span class="s1">&#39;</span><span class="si">{</span><span class="n">class_name</span><span class="si">}</span><span class="s1">&#39;</span><span class="p">)</span>
    <span class="n">axs</span><span class="p">[</span><span class="n">i</span><span class="o">+</span><span class="mi">1</span><span class="p">]</span><span class="o">.</span><span class="n">axis</span><span class="p">(</span><span class="s1">&#39;off&#39;</span><span class="p">)</span>

<span class="n">plt</span><span class="o">.</span><span class="n">tight_layout</span><span class="p">()</span>
<span class="n">plt</span><span class="o">.</span><span class="n">show</span><span class="p">()</span>
</pre></div>
</div>
</section>
<section id="pytorch-custom-target">
<h3><a class="toc-backref" href="#id6" role="doc-backlink">PyTorch Custom Target</a><a class="headerlink" href="#pytorch-custom-target" title="Link to this heading">ÔÉÅ</a></h3>
<div class="highlight-python notranslate"><div class="highlight"><pre><span></span><span class="c1"># Get predictions</span>
<span class="k">with</span> <span class="n">torch</span><span class="o">.</span><span class="n">no_grad</span><span class="p">():</span>
    <span class="n">output</span> <span class="o">=</span> <span class="n">model</span><span class="p">(</span><span class="n">input_tensor</span><span class="p">)</span>

<span class="c1"># Get top 5 predicted classes</span>
<span class="n">_</span><span class="p">,</span> <span class="n">top_indices</span> <span class="o">=</span> <span class="n">torch</span><span class="o">.</span><span class="n">topk</span><span class="p">(</span><span class="n">output</span><span class="p">,</span> <span class="mi">5</span><span class="p">,</span> <span class="n">dim</span><span class="o">=</span><span class="mi">1</span><span class="p">)</span>
<span class="n">top_classes</span> <span class="o">=</span> <span class="n">top_indices</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span><span class="o">.</span><span class="n">tolist</span><span class="p">()</span>

<span class="c1"># Generate explanations for each class</span>
<span class="n">class_explanations</span> <span class="o">=</span> <span class="p">{}</span>
<span class="k">for</span> <span class="n">idx</span> <span class="ow">in</span> <span class="n">top_classes</span><span class="p">:</span>
    <span class="n">class_explanations</span><span class="p">[</span><span class="n">idx</span><span class="p">]</span> <span class="o">=</span> <span class="n">calculate_relevancemap</span><span class="p">(</span>
        <span class="n">model_no_softmax</span><span class="p">,</span>
        <span class="n">input_tensor</span><span class="p">,</span>
        <span class="n">method</span><span class="o">=</span><span class="s2">&quot;gradient_x_input&quot;</span><span class="p">,</span>
        <span class="n">target_class</span><span class="o">=</span><span class="n">idx</span>  <span class="c1"># Specific class</span>
    <span class="p">)</span>

<span class="c1"># Visualize explanations for different classes</span>
<span class="n">fig</span><span class="p">,</span> <span class="n">axs</span> <span class="o">=</span> <span class="n">plt</span><span class="o">.</span><span class="n">subplots</span><span class="p">(</span><span class="mi">1</span><span class="p">,</span> <span class="nb">len</span><span class="p">(</span><span class="n">top_classes</span><span class="p">)</span> <span class="o">+</span> <span class="mi">1</span><span class="p">,</span> <span class="n">figsize</span><span class="o">=</span><span class="p">(</span><span class="mi">15</span><span class="p">,</span> <span class="mi">4</span><span class="p">))</span>

<span class="c1"># Original image</span>
<span class="n">axs</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span><span class="o">.</span><span class="n">imshow</span><span class="p">(</span><span class="n">img_np</span><span class="p">)</span>
<span class="n">axs</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span><span class="o">.</span><span class="n">set_title</span><span class="p">(</span><span class="s1">&#39;Original&#39;</span><span class="p">)</span>
<span class="n">axs</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span><span class="o">.</span><span class="n">axis</span><span class="p">(</span><span class="s1">&#39;off&#39;</span><span class="p">)</span>

<span class="c1"># Class-specific explanations</span>
<span class="k">for</span> <span class="n">i</span><span class="p">,</span> <span class="n">idx</span> <span class="ow">in</span> <span class="nb">enumerate</span><span class="p">(</span><span class="n">top_classes</span><span class="p">):</span>
    <span class="n">explanation</span> <span class="o">=</span> <span class="n">class_explanations</span><span class="p">[</span><span class="n">idx</span><span class="p">][</span><span class="mi">0</span><span class="p">]</span><span class="o">.</span><span class="n">sum</span><span class="p">(</span><span class="n">axis</span><span class="o">=</span><span class="mi">0</span><span class="p">)</span>
    <span class="n">axs</span><span class="p">[</span><span class="n">i</span><span class="o">+</span><span class="mi">1</span><span class="p">]</span><span class="o">.</span><span class="n">imshow</span><span class="p">(</span><span class="n">normalize_relevance_map</span><span class="p">(</span><span class="n">explanation</span><span class="p">),</span> <span class="n">cmap</span><span class="o">=</span><span class="s1">&#39;seismic&#39;</span><span class="p">,</span> <span class="n">clim</span><span class="o">=</span><span class="p">(</span><span class="o">-</span><span class="mi">1</span><span class="p">,</span> <span class="mi">1</span><span class="p">))</span>
    <span class="n">axs</span><span class="p">[</span><span class="n">i</span><span class="o">+</span><span class="mi">1</span><span class="p">]</span><span class="o">.</span><span class="n">set_title</span><span class="p">(</span><span class="sa">f</span><span class="s1">&#39;Class </span><span class="si">{</span><span class="n">idx</span><span class="si">}</span><span class="s1">&#39;</span><span class="p">)</span>
    <span class="n">axs</span><span class="p">[</span><span class="n">i</span><span class="o">+</span><span class="mi">1</span><span class="p">]</span><span class="o">.</span><span class="n">axis</span><span class="p">(</span><span class="s1">&#39;off&#39;</span><span class="p">)</span>

<span class="n">plt</span><span class="o">.</span><span class="n">tight_layout</span><span class="p">()</span>
<span class="n">plt</span><span class="o">.</span><span class="n">show</span><span class="p">()</span>
</pre></div>
</div>
</section>
</section>
<section id="working-with-time-series-data">
<h2><a class="toc-backref" href="#id7" role="doc-backlink">Working with Time Series Data</a><a class="headerlink" href="#working-with-time-series-data" title="Link to this heading">ÔÉÅ</a></h2>
<p>SignXAI supports time series data such as ECG signals:</p>
<section id="tensorflow-time-series">
<h3><a class="toc-backref" href="#id8" role="doc-backlink">TensorFlow Time Series</a><a class="headerlink" href="#tensorflow-time-series" title="Link to this heading">ÔÉÅ</a></h3>
<div class="highlight-python notranslate"><div class="highlight"><pre><span></span><span class="kn">import</span> <span class="nn">numpy</span> <span class="k">as</span> <span class="nn">np</span>
<span class="kn">import</span> <span class="nn">matplotlib.pyplot</span> <span class="k">as</span> <span class="nn">plt</span>
<span class="kn">import</span> <span class="nn">tensorflow</span> <span class="k">as</span> <span class="nn">tf</span>
<span class="kn">from</span> <span class="nn">signxai.tf_signxai</span> <span class="kn">import</span> <span class="n">calculate_relevancemap</span>

<span class="c1"># Load a pre-trained ECG model</span>
<span class="n">model</span> <span class="o">=</span> <span class="n">tf</span><span class="o">.</span><span class="n">keras</span><span class="o">.</span><span class="n">models</span><span class="o">.</span><span class="n">load_model</span><span class="p">(</span><span class="s1">&#39;ecg_model.h5&#39;</span><span class="p">)</span>
<span class="n">model</span><span class="o">.</span><span class="n">layers</span><span class="p">[</span><span class="o">-</span><span class="mi">1</span><span class="p">]</span><span class="o">.</span><span class="n">activation</span> <span class="o">=</span> <span class="kc">None</span>

<span class="c1"># Load an ECG signal</span>
<span class="n">ecg_signal</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">load</span><span class="p">(</span><span class="s1">&#39;ecg_sample.npy&#39;</span><span class="p">)</span>
<span class="n">ecg_input</span> <span class="o">=</span> <span class="n">ecg_signal</span><span class="o">.</span><span class="n">reshape</span><span class="p">(</span><span class="mi">1</span><span class="p">,</span> <span class="o">-</span><span class="mi">1</span><span class="p">,</span> <span class="mi">1</span><span class="p">)</span>  <span class="c1"># Add batch and channel dimensions</span>

<span class="c1"># Calculate explanation</span>
<span class="n">explanation</span> <span class="o">=</span> <span class="n">calculate_relevancemap</span><span class="p">(</span>
    <span class="s1">&#39;gradient_x_input&#39;</span><span class="p">,</span>
    <span class="n">ecg_input</span><span class="p">,</span>
    <span class="n">model</span>
<span class="p">)</span>

<span class="c1"># Plot original signal and explanation</span>
<span class="n">plt</span><span class="o">.</span><span class="n">figure</span><span class="p">(</span><span class="n">figsize</span><span class="o">=</span><span class="p">(</span><span class="mi">12</span><span class="p">,</span> <span class="mi">6</span><span class="p">))</span>

<span class="n">plt</span><span class="o">.</span><span class="n">subplot</span><span class="p">(</span><span class="mi">2</span><span class="p">,</span> <span class="mi">1</span><span class="p">,</span> <span class="mi">1</span><span class="p">)</span>
<span class="n">plt</span><span class="o">.</span><span class="n">plot</span><span class="p">(</span><span class="n">ecg_signal</span><span class="p">)</span>
<span class="n">plt</span><span class="o">.</span><span class="n">title</span><span class="p">(</span><span class="s1">&#39;Original ECG Signal&#39;</span><span class="p">)</span>
<span class="n">plt</span><span class="o">.</span><span class="n">grid</span><span class="p">(</span><span class="kc">True</span><span class="p">)</span>

<span class="n">plt</span><span class="o">.</span><span class="n">subplot</span><span class="p">(</span><span class="mi">2</span><span class="p">,</span> <span class="mi">1</span><span class="p">,</span> <span class="mi">2</span><span class="p">)</span>
<span class="n">plt</span><span class="o">.</span><span class="n">plot</span><span class="p">(</span><span class="n">explanation</span><span class="p">[</span><span class="mi">0</span><span class="p">,</span> <span class="p">:,</span> <span class="mi">0</span><span class="p">])</span>
<span class="n">plt</span><span class="o">.</span><span class="n">title</span><span class="p">(</span><span class="s1">&#39;Explanation&#39;</span><span class="p">)</span>
<span class="n">plt</span><span class="o">.</span><span class="n">grid</span><span class="p">(</span><span class="kc">True</span><span class="p">)</span>

<span class="n">plt</span><span class="o">.</span><span class="n">tight_layout</span><span class="p">()</span>
<span class="n">plt</span><span class="o">.</span><span class="n">show</span><span class="p">()</span>

<span class="c1"># For 1D time series, GradCAM requires a specific implementation</span>
<span class="n">gradcam_explanation</span> <span class="o">=</span> <span class="n">calculate_relevancemap</span><span class="p">(</span>
    <span class="s1">&#39;grad_cam_timeseries&#39;</span><span class="p">,</span>
    <span class="n">ecg_input</span><span class="p">,</span>
    <span class="n">model</span><span class="p">,</span>
    <span class="n">last_conv_layer_name</span><span class="o">=</span><span class="s1">&#39;conv1d_3&#39;</span>  <span class="c1"># Specify convolutional layer</span>
<span class="p">)</span>

<span class="c1"># Plot GradCAM explanation</span>
<span class="n">plt</span><span class="o">.</span><span class="n">figure</span><span class="p">(</span><span class="n">figsize</span><span class="o">=</span><span class="p">(</span><span class="mi">12</span><span class="p">,</span> <span class="mi">3</span><span class="p">))</span>
<span class="n">plt</span><span class="o">.</span><span class="n">plot</span><span class="p">(</span><span class="n">gradcam_explanation</span><span class="p">[</span><span class="mi">0</span><span class="p">,</span> <span class="p">:,</span> <span class="mi">0</span><span class="p">])</span>
<span class="n">plt</span><span class="o">.</span><span class="n">title</span><span class="p">(</span><span class="s1">&#39;GradCAM Explanation for Time Series&#39;</span><span class="p">)</span>
<span class="n">plt</span><span class="o">.</span><span class="n">grid</span><span class="p">(</span><span class="kc">True</span><span class="p">)</span>
<span class="n">plt</span><span class="o">.</span><span class="n">show</span><span class="p">()</span>
</pre></div>
</div>
</section>
<section id="pytorch-time-series">
<h3><a class="toc-backref" href="#id9" role="doc-backlink">PyTorch Time Series</a><a class="headerlink" href="#pytorch-time-series" title="Link to this heading">ÔÉÅ</a></h3>
<div class="highlight-python notranslate"><div class="highlight"><pre><span></span><span class="kn">import</span> <span class="nn">torch</span>
<span class="kn">import</span> <span class="nn">torch.nn</span> <span class="k">as</span> <span class="nn">nn</span>
<span class="kn">import</span> <span class="nn">numpy</span> <span class="k">as</span> <span class="nn">np</span>
<span class="kn">import</span> <span class="nn">matplotlib.pyplot</span> <span class="k">as</span> <span class="nn">plt</span>
<span class="kn">from</span> <span class="nn">signxai.torch_signxai</span> <span class="kn">import</span> <span class="n">calculate_relevancemap</span>
<span class="kn">from</span> <span class="nn">signxai.torch_signxai.utils</span> <span class="kn">import</span> <span class="n">remove_softmax</span>

<span class="c1"># Define a simple 1D CNN for time series</span>
<span class="k">class</span> <span class="nc">ECG_CNN</span><span class="p">(</span><span class="n">nn</span><span class="o">.</span><span class="n">Module</span><span class="p">):</span>
    <span class="k">def</span> <span class="fm">__init__</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="nb">super</span><span class="p">(</span><span class="n">ECG_CNN</span><span class="p">,</span> <span class="bp">self</span><span class="p">)</span><span class="o">.</span><span class="fm">__init__</span><span class="p">()</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">conv1</span> <span class="o">=</span> <span class="n">nn</span><span class="o">.</span><span class="n">Conv1d</span><span class="p">(</span><span class="mi">1</span><span class="p">,</span> <span class="mi">32</span><span class="p">,</span> <span class="n">kernel_size</span><span class="o">=</span><span class="mi">5</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">conv2</span> <span class="o">=</span> <span class="n">nn</span><span class="o">.</span><span class="n">Conv1d</span><span class="p">(</span><span class="mi">32</span><span class="p">,</span> <span class="mi">32</span><span class="p">,</span> <span class="n">kernel_size</span><span class="o">=</span><span class="mi">5</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">pool</span> <span class="o">=</span> <span class="n">nn</span><span class="o">.</span><span class="n">MaxPool1d</span><span class="p">(</span><span class="mi">2</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">flatten</span> <span class="o">=</span> <span class="n">nn</span><span class="o">.</span><span class="n">Flatten</span><span class="p">()</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">fc1</span> <span class="o">=</span> <span class="n">nn</span><span class="o">.</span><span class="n">Linear</span><span class="p">(</span><span class="mi">32</span><span class="o">*</span><span class="mi">123</span><span class="p">,</span> <span class="mi">64</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">fc2</span> <span class="o">=</span> <span class="n">nn</span><span class="o">.</span><span class="n">Linear</span><span class="p">(</span><span class="mi">64</span><span class="p">,</span> <span class="mi">5</span><span class="p">)</span>  <span class="c1"># 5 classes</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">relu</span> <span class="o">=</span> <span class="n">nn</span><span class="o">.</span><span class="n">ReLU</span><span class="p">()</span>

    <span class="k">def</span> <span class="nf">forward</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">x</span><span class="p">):</span>
        <span class="n">x</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">relu</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">conv1</span><span class="p">(</span><span class="n">x</span><span class="p">))</span>
        <span class="n">x</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">pool</span><span class="p">(</span><span class="n">x</span><span class="p">)</span>
        <span class="n">x</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">relu</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">conv2</span><span class="p">(</span><span class="n">x</span><span class="p">))</span>
        <span class="n">x</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">pool</span><span class="p">(</span><span class="n">x</span><span class="p">)</span>
        <span class="n">x</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">flatten</span><span class="p">(</span><span class="n">x</span><span class="p">)</span>
        <span class="n">x</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">relu</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">fc1</span><span class="p">(</span><span class="n">x</span><span class="p">))</span>
        <span class="n">x</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">fc2</span><span class="p">(</span><span class="n">x</span><span class="p">)</span>
        <span class="k">return</span> <span class="n">x</span>

<span class="c1"># Load model and weights</span>
<span class="n">model</span> <span class="o">=</span> <span class="n">ECG_CNN</span><span class="p">()</span>
<span class="n">model</span><span class="o">.</span><span class="n">load_state_dict</span><span class="p">(</span><span class="n">torch</span><span class="o">.</span><span class="n">load</span><span class="p">(</span><span class="s1">&#39;ecg_model.pt&#39;</span><span class="p">))</span>
<span class="n">model</span><span class="o">.</span><span class="n">eval</span><span class="p">()</span>

<span class="c1"># Remove softmax</span>
<span class="n">model_no_softmax</span> <span class="o">=</span> <span class="n">remove_softmax</span><span class="p">(</span><span class="n">model</span><span class="p">)</span>

<span class="c1"># Load an ECG signal</span>
<span class="n">ecg_signal</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">load</span><span class="p">(</span><span class="s1">&#39;ecg_sample.npy&#39;</span><span class="p">)</span>

<span class="c1"># Convert to PyTorch tensor with shape [batch, channels, time]</span>
<span class="n">ecg_input</span> <span class="o">=</span> <span class="n">torch</span><span class="o">.</span><span class="n">tensor</span><span class="p">(</span><span class="n">ecg_signal</span><span class="p">,</span> <span class="n">dtype</span><span class="o">=</span><span class="n">torch</span><span class="o">.</span><span class="n">float32</span><span class="p">)</span><span class="o">.</span><span class="n">reshape</span><span class="p">(</span><span class="mi">1</span><span class="p">,</span> <span class="mi">1</span><span class="p">,</span> <span class="o">-</span><span class="mi">1</span><span class="p">)</span>

<span class="c1"># Calculate explanation</span>
<span class="n">explanation</span> <span class="o">=</span> <span class="n">calculate_relevancemap</span><span class="p">(</span>
    <span class="n">model_no_softmax</span><span class="p">,</span>
    <span class="n">ecg_input</span><span class="p">,</span>
    <span class="n">method</span><span class="o">=</span><span class="s2">&quot;input_t_gradient&quot;</span>
<span class="p">)</span>

<span class="c1"># Plot original signal and explanation</span>
<span class="n">plt</span><span class="o">.</span><span class="n">figure</span><span class="p">(</span><span class="n">figsize</span><span class="o">=</span><span class="p">(</span><span class="mi">12</span><span class="p">,</span> <span class="mi">6</span><span class="p">))</span>

<span class="n">plt</span><span class="o">.</span><span class="n">subplot</span><span class="p">(</span><span class="mi">2</span><span class="p">,</span> <span class="mi">1</span><span class="p">,</span> <span class="mi">1</span><span class="p">)</span>
<span class="n">plt</span><span class="o">.</span><span class="n">plot</span><span class="p">(</span><span class="n">ecg_signal</span><span class="p">)</span>
<span class="n">plt</span><span class="o">.</span><span class="n">title</span><span class="p">(</span><span class="s1">&#39;Original ECG Signal&#39;</span><span class="p">)</span>
<span class="n">plt</span><span class="o">.</span><span class="n">grid</span><span class="p">(</span><span class="kc">True</span><span class="p">)</span>

<span class="n">plt</span><span class="o">.</span><span class="n">subplot</span><span class="p">(</span><span class="mi">2</span><span class="p">,</span> <span class="mi">1</span><span class="p">,</span> <span class="mi">2</span><span class="p">)</span>
<span class="n">plt</span><span class="o">.</span><span class="n">plot</span><span class="p">(</span><span class="n">explanation</span><span class="p">[</span><span class="mi">0</span><span class="p">,</span> <span class="mi">0</span><span class="p">,</span> <span class="p">:])</span>
<span class="n">plt</span><span class="o">.</span><span class="n">title</span><span class="p">(</span><span class="s1">&#39;Explanation&#39;</span><span class="p">)</span>
<span class="n">plt</span><span class="o">.</span><span class="n">grid</span><span class="p">(</span><span class="kc">True</span><span class="p">)</span>

<span class="n">plt</span><span class="o">.</span><span class="n">tight_layout</span><span class="p">()</span>
<span class="n">plt</span><span class="o">.</span><span class="n">show</span><span class="p">()</span>
</pre></div>
</div>
</section>
</section>
<section id="custom-sign-methods">
<h2><a class="toc-backref" href="#id10" role="doc-backlink">Custom SIGN Methods</a><a class="headerlink" href="#custom-sign-methods" title="Link to this heading">ÔÉÅ</a></h2>
<p>The SIGN method is a key innovation in SignXAI. Here‚Äôs how to use it with custom parameters:</p>
<section id="tensorflow-sign">
<h3><a class="toc-backref" href="#id11" role="doc-backlink">TensorFlow SIGN</a><a class="headerlink" href="#tensorflow-sign" title="Link to this heading">ÔÉÅ</a></h3>
<div class="highlight-python notranslate"><div class="highlight"><pre><span></span><span class="kn">from</span> <span class="nn">signxai.tf_signxai.methods.signed</span> <span class="kn">import</span> <span class="n">calculate_sign_mu</span>

<span class="c1"># Standard SIGN with mu=0</span>
<span class="n">sign</span> <span class="o">=</span> <span class="n">calculate_sign_mu</span><span class="p">(</span><span class="n">input_tensor</span><span class="p">,</span> <span class="n">mu</span><span class="o">=</span><span class="mi">0</span><span class="p">)</span>

<span class="c1"># Custom SIGN methods with different mu values</span>
<span class="n">sign_pos</span> <span class="o">=</span> <span class="n">calculate_sign_mu</span><span class="p">(</span><span class="n">input_tensor</span><span class="p">,</span> <span class="n">mu</span><span class="o">=</span><span class="mf">0.5</span><span class="p">)</span>     <span class="c1"># Focus on positive values</span>
<span class="n">sign_neg</span> <span class="o">=</span> <span class="n">calculate_sign_mu</span><span class="p">(</span><span class="n">input_tensor</span><span class="p">,</span> <span class="n">mu</span><span class="o">=-</span><span class="mf">0.5</span><span class="p">)</span>    <span class="c1"># Focus on negative values</span>

<span class="c1"># Apply SIGN with gradient</span>
<span class="n">gradient</span> <span class="o">=</span> <span class="n">calculate_relevancemap</span><span class="p">(</span><span class="s1">&#39;gradient&#39;</span><span class="p">,</span> <span class="n">input_tensor</span><span class="p">,</span> <span class="n">model</span><span class="p">)</span>

<span class="c1"># Manually apply SIGN</span>
<span class="n">gradient_sign</span> <span class="o">=</span> <span class="n">gradient</span> <span class="o">*</span> <span class="n">sign</span>
<span class="n">gradient_sign_pos</span> <span class="o">=</span> <span class="n">gradient</span> <span class="o">*</span> <span class="n">sign_pos</span>
<span class="n">gradient_sign_neg</span> <span class="o">=</span> <span class="n">gradient</span> <span class="o">*</span> <span class="n">sign_neg</span>

<span class="c1"># Or use built-in methods</span>
<span class="n">gradient_sign_direct</span> <span class="o">=</span> <span class="n">calculate_relevancemap</span><span class="p">(</span><span class="s1">&#39;gradient_x_sign&#39;</span><span class="p">,</span> <span class="n">input_tensor</span><span class="p">,</span> <span class="n">model</span><span class="p">)</span>
<span class="n">gradient_sign_mu</span> <span class="o">=</span> <span class="n">calculate_relevancemap</span><span class="p">(</span><span class="s1">&#39;gradient_x_sign_mu&#39;</span><span class="p">,</span> <span class="n">input_tensor</span><span class="p">,</span> <span class="n">model</span><span class="p">,</span> <span class="n">mu</span><span class="o">=</span><span class="mf">0.5</span><span class="p">)</span>
</pre></div>
</div>
</section>
<section id="pytorch-sign">
<h3><a class="toc-backref" href="#id12" role="doc-backlink">PyTorch SIGN</a><a class="headerlink" href="#pytorch-sign" title="Link to this heading">ÔÉÅ</a></h3>
<div class="highlight-python notranslate"><div class="highlight"><pre><span></span><span class="kn">from</span> <span class="nn">signxai.torch_signxai.methods.signed</span> <span class="kn">import</span> <span class="n">calculate_sign_mu</span>

<span class="c1"># Standard SIGN with mu=0</span>
<span class="n">sign</span> <span class="o">=</span> <span class="n">calculate_sign_mu</span><span class="p">(</span><span class="n">input_tensor</span><span class="p">,</span> <span class="n">mu</span><span class="o">=</span><span class="mi">0</span><span class="p">)</span>

<span class="c1"># Custom SIGN methods with different mu values</span>
<span class="n">sign_pos</span> <span class="o">=</span> <span class="n">calculate_sign_mu</span><span class="p">(</span><span class="n">input_tensor</span><span class="p">,</span> <span class="n">mu</span><span class="o">=</span><span class="mf">0.5</span><span class="p">)</span>     <span class="c1"># Focus on positive values</span>
<span class="n">sign_neg</span> <span class="o">=</span> <span class="n">calculate_sign_mu</span><span class="p">(</span><span class="n">input_tensor</span><span class="p">,</span> <span class="n">mu</span><span class="o">=-</span><span class="mf">0.5</span><span class="p">)</span>    <span class="c1"># Focus on negative values</span>

<span class="c1"># Apply SIGN with gradient</span>
<span class="n">gradient</span> <span class="o">=</span> <span class="n">calculate_relevancemap</span><span class="p">(</span><span class="n">model_no_softmax</span><span class="p">,</span> <span class="n">input_tensor</span><span class="p">,</span> <span class="n">method</span><span class="o">=</span><span class="s2">&quot;gradients&quot;</span><span class="p">)</span>

<span class="c1"># Convert to tensor if needed</span>
<span class="k">if</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">gradient</span><span class="p">,</span> <span class="n">np</span><span class="o">.</span><span class="n">ndarray</span><span class="p">):</span>
    <span class="n">gradient</span> <span class="o">=</span> <span class="n">torch</span><span class="o">.</span><span class="n">tensor</span><span class="p">(</span><span class="n">gradient</span><span class="p">)</span>

<span class="c1"># Manually apply SIGN</span>
<span class="n">gradient_sign</span> <span class="o">=</span> <span class="n">gradient</span> <span class="o">*</span> <span class="n">sign</span>
<span class="n">gradient_sign_pos</span> <span class="o">=</span> <span class="n">gradient</span> <span class="o">*</span> <span class="n">sign_pos</span>
<span class="n">gradient_sign_neg</span> <span class="o">=</span> <span class="n">gradient</span> <span class="o">*</span> <span class="n">sign_neg</span>
</pre></div>
</div>
</section>
</section>
<section id="integrating-with-other-libraries">
<h2><a class="toc-backref" href="#id13" role="doc-backlink">Integrating with Other Libraries</a><a class="headerlink" href="#integrating-with-other-libraries" title="Link to this heading">ÔÉÅ</a></h2>
<p>SignXAI can be used alongside other explainability libraries:</p>
<section id="shap-integration">
<h3><a class="toc-backref" href="#id14" role="doc-backlink">SHAP Integration</a><a class="headerlink" href="#shap-integration" title="Link to this heading">ÔÉÅ</a></h3>
<div class="highlight-python notranslate"><div class="highlight"><pre><span></span><span class="kn">import</span> <span class="nn">shap</span>

<span class="c1"># TensorFlow</span>
<span class="c1"># Create a SHAP explainer</span>
<span class="n">explainer</span> <span class="o">=</span> <span class="n">shap</span><span class="o">.</span><span class="n">GradientExplainer</span><span class="p">(</span><span class="n">model</span><span class="p">,</span> <span class="n">background_dataset</span><span class="p">)</span>
<span class="n">shap_values</span> <span class="o">=</span> <span class="n">explainer</span><span class="o">.</span><span class="n">shap_values</span><span class="p">(</span><span class="n">x</span><span class="p">)</span>

<span class="c1"># Calculate SignXAI explanation</span>
<span class="n">signxai_explanation</span> <span class="o">=</span> <span class="n">calculate_relevancemap</span><span class="p">(</span><span class="s1">&#39;gradient_x_input&#39;</span><span class="p">,</span> <span class="n">x</span><span class="p">,</span> <span class="n">model</span><span class="p">)</span>

<span class="c1"># Compare explanations</span>
<span class="n">plt</span><span class="o">.</span><span class="n">figure</span><span class="p">(</span><span class="n">figsize</span><span class="o">=</span><span class="p">(</span><span class="mi">12</span><span class="p">,</span> <span class="mi">4</span><span class="p">))</span>

<span class="n">plt</span><span class="o">.</span><span class="n">subplot</span><span class="p">(</span><span class="mi">1</span><span class="p">,</span> <span class="mi">2</span><span class="p">,</span> <span class="mi">1</span><span class="p">)</span>
<span class="n">shap</span><span class="o">.</span><span class="n">image_plot</span><span class="p">(</span><span class="n">shap_values</span><span class="p">,</span> <span class="n">x</span><span class="p">,</span> <span class="n">show</span><span class="o">=</span><span class="kc">False</span><span class="p">)</span>
<span class="n">plt</span><span class="o">.</span><span class="n">title</span><span class="p">(</span><span class="s1">&#39;SHAP Explanation&#39;</span><span class="p">)</span>

<span class="n">plt</span><span class="o">.</span><span class="n">subplot</span><span class="p">(</span><span class="mi">1</span><span class="p">,</span> <span class="mi">2</span><span class="p">,</span> <span class="mi">2</span><span class="p">)</span>
<span class="n">plt</span><span class="o">.</span><span class="n">imshow</span><span class="p">(</span><span class="n">normalize_heatmap</span><span class="p">(</span><span class="n">signxai_explanation</span><span class="p">[</span><span class="mi">0</span><span class="p">]),</span> <span class="n">cmap</span><span class="o">=</span><span class="s1">&#39;seismic&#39;</span><span class="p">,</span> <span class="n">clim</span><span class="o">=</span><span class="p">(</span><span class="o">-</span><span class="mi">1</span><span class="p">,</span> <span class="mi">1</span><span class="p">))</span>
<span class="n">plt</span><span class="o">.</span><span class="n">title</span><span class="p">(</span><span class="s1">&#39;SignXAI Explanation&#39;</span><span class="p">)</span>
<span class="n">plt</span><span class="o">.</span><span class="n">axis</span><span class="p">(</span><span class="s1">&#39;off&#39;</span><span class="p">)</span>

<span class="n">plt</span><span class="o">.</span><span class="n">tight_layout</span><span class="p">()</span>
<span class="n">plt</span><span class="o">.</span><span class="n">show</span><span class="p">()</span>
</pre></div>
</div>
</section>
<section id="captum-integration">
<h3><a class="toc-backref" href="#id15" role="doc-backlink">Captum Integration</a><a class="headerlink" href="#captum-integration" title="Link to this heading">ÔÉÅ</a></h3>
<div class="highlight-python notranslate"><div class="highlight"><pre><span></span><span class="kn">from</span> <span class="nn">captum.attr</span> <span class="kn">import</span> <span class="n">IntegratedGradients</span>

<span class="c1"># PyTorch with Captum</span>
<span class="n">ig</span> <span class="o">=</span> <span class="n">IntegratedGradients</span><span class="p">(</span><span class="n">model</span><span class="p">)</span>
<span class="n">captum_attr</span> <span class="o">=</span> <span class="n">ig</span><span class="o">.</span><span class="n">attribute</span><span class="p">(</span><span class="n">input_tensor</span><span class="p">,</span> <span class="n">target</span><span class="o">=</span><span class="n">predicted_idx</span><span class="p">)</span>

<span class="c1"># SignXAI explanation</span>
<span class="n">signxai_attr</span> <span class="o">=</span> <span class="n">calculate_relevancemap</span><span class="p">(</span>
    <span class="n">model</span><span class="p">,</span>
    <span class="n">input_tensor</span><span class="p">,</span>
    <span class="n">method</span><span class="o">=</span><span class="s2">&quot;integrated_gradients&quot;</span>
<span class="p">)</span>

<span class="c1"># Compare explanations</span>
<span class="n">plt</span><span class="o">.</span><span class="n">figure</span><span class="p">(</span><span class="n">figsize</span><span class="o">=</span><span class="p">(</span><span class="mi">12</span><span class="p">,</span> <span class="mi">4</span><span class="p">))</span>

<span class="n">plt</span><span class="o">.</span><span class="n">subplot</span><span class="p">(</span><span class="mi">1</span><span class="p">,</span> <span class="mi">2</span><span class="p">,</span> <span class="mi">1</span><span class="p">)</span>
<span class="n">plt</span><span class="o">.</span><span class="n">imshow</span><span class="p">(</span><span class="n">captum_attr</span><span class="o">.</span><span class="n">sum</span><span class="p">(</span><span class="n">dim</span><span class="o">=</span><span class="mi">1</span><span class="p">)[</span><span class="mi">0</span><span class="p">]</span><span class="o">.</span><span class="n">detach</span><span class="p">()</span><span class="o">.</span><span class="n">cpu</span><span class="p">()</span><span class="o">.</span><span class="n">numpy</span><span class="p">(),</span> <span class="n">cmap</span><span class="o">=</span><span class="s1">&#39;seismic&#39;</span><span class="p">)</span>
<span class="n">plt</span><span class="o">.</span><span class="n">title</span><span class="p">(</span><span class="s1">&#39;Captum Explanation&#39;</span><span class="p">)</span>
<span class="n">plt</span><span class="o">.</span><span class="n">axis</span><span class="p">(</span><span class="s1">&#39;off&#39;</span><span class="p">)</span>

<span class="n">plt</span><span class="o">.</span><span class="n">subplot</span><span class="p">(</span><span class="mi">1</span><span class="p">,</span> <span class="mi">2</span><span class="p">,</span> <span class="mi">2</span><span class="p">)</span>
<span class="n">plt</span><span class="o">.</span><span class="n">imshow</span><span class="p">(</span><span class="n">signxai_attr</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span><span class="o">.</span><span class="n">sum</span><span class="p">(</span><span class="n">axis</span><span class="o">=</span><span class="mi">0</span><span class="p">),</span> <span class="n">cmap</span><span class="o">=</span><span class="s1">&#39;seismic&#39;</span><span class="p">)</span>
<span class="n">plt</span><span class="o">.</span><span class="n">title</span><span class="p">(</span><span class="s1">&#39;SignXAI Explanation&#39;</span><span class="p">)</span>
<span class="n">plt</span><span class="o">.</span><span class="n">axis</span><span class="p">(</span><span class="s1">&#39;off&#39;</span><span class="p">)</span>

<span class="n">plt</span><span class="o">.</span><span class="n">tight_layout</span><span class="p">()</span>
<span class="n">plt</span><span class="o">.</span><span class="n">show</span><span class="p">()</span>
</pre></div>
</div>
</section>
</section>
<section id="advanced-visualization-techniques">
<h2><a class="toc-backref" href="#id16" role="doc-backlink">Advanced Visualization Techniques</a><a class="headerlink" href="#advanced-visualization-techniques" title="Link to this heading">ÔÉÅ</a></h2>
<p>SignXAI provides advanced visualization options:</p>
<section id="overlay-with-transparency">
<h3><a class="toc-backref" href="#id17" role="doc-backlink">Overlay with Transparency</a><a class="headerlink" href="#overlay-with-transparency" title="Link to this heading">ÔÉÅ</a></h3>
<div class="highlight-python notranslate"><div class="highlight"><pre><span></span><span class="kn">from</span> <span class="nn">signxai.common.visualization</span> <span class="kn">import</span> <span class="p">(</span>
    <span class="n">normalize_relevance_map</span><span class="p">,</span>
    <span class="n">relevance_to_heatmap</span><span class="p">,</span>
    <span class="n">overlay_heatmap</span>
<span class="p">)</span>

<span class="c1"># Generate explanation</span>
<span class="n">explanation</span> <span class="o">=</span> <span class="n">calculate_relevancemap</span><span class="p">(</span>
    <span class="n">model</span><span class="p">,</span>
    <span class="n">input_tensor</span><span class="p">,</span>
    <span class="n">method</span><span class="o">=</span><span class="s2">&quot;lrp_z&quot;</span>
<span class="p">)</span>

<span class="c1"># Normalize explanation</span>
<span class="n">normalized</span> <span class="o">=</span> <span class="n">normalize_relevance_map</span><span class="p">(</span><span class="n">explanation</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span><span class="o">.</span><span class="n">sum</span><span class="p">(</span><span class="n">axis</span><span class="o">=</span><span class="mi">0</span><span class="p">))</span>

<span class="c1"># Create heatmap</span>
<span class="n">heatmap</span> <span class="o">=</span> <span class="n">relevance_to_heatmap</span><span class="p">(</span><span class="n">normalized</span><span class="p">,</span> <span class="n">cmap</span><span class="o">=</span><span class="s1">&#39;seismic&#39;</span><span class="p">)</span>

<span class="c1"># Create overlays with different transparency levels</span>
<span class="n">fig</span><span class="p">,</span> <span class="n">axs</span> <span class="o">=</span> <span class="n">plt</span><span class="o">.</span><span class="n">subplots</span><span class="p">(</span><span class="mi">1</span><span class="p">,</span> <span class="mi">4</span><span class="p">,</span> <span class="n">figsize</span><span class="o">=</span><span class="p">(</span><span class="mi">16</span><span class="p">,</span> <span class="mi">4</span><span class="p">))</span>

<span class="n">axs</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span><span class="o">.</span><span class="n">imshow</span><span class="p">(</span><span class="n">original_image</span><span class="p">)</span>
<span class="n">axs</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span><span class="o">.</span><span class="n">set_title</span><span class="p">(</span><span class="s1">&#39;Original Image&#39;</span><span class="p">)</span>
<span class="n">axs</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span><span class="o">.</span><span class="n">axis</span><span class="p">(</span><span class="s1">&#39;off&#39;</span><span class="p">)</span>

<span class="k">for</span> <span class="n">i</span><span class="p">,</span> <span class="n">alpha</span> <span class="ow">in</span> <span class="nb">enumerate</span><span class="p">([</span><span class="mf">0.3</span><span class="p">,</span> <span class="mf">0.5</span><span class="p">,</span> <span class="mf">0.7</span><span class="p">]):</span>
    <span class="n">overlaid</span> <span class="o">=</span> <span class="n">overlay_heatmap</span><span class="p">(</span><span class="n">original_image</span><span class="p">,</span> <span class="n">heatmap</span><span class="p">,</span> <span class="n">alpha</span><span class="o">=</span><span class="n">alpha</span><span class="p">)</span>
    <span class="n">axs</span><span class="p">[</span><span class="n">i</span><span class="o">+</span><span class="mi">1</span><span class="p">]</span><span class="o">.</span><span class="n">imshow</span><span class="p">(</span><span class="n">overlaid</span><span class="p">)</span>
    <span class="n">axs</span><span class="p">[</span><span class="n">i</span><span class="o">+</span><span class="mi">1</span><span class="p">]</span><span class="o">.</span><span class="n">set_title</span><span class="p">(</span><span class="sa">f</span><span class="s1">&#39;Overlay (alpha=</span><span class="si">{</span><span class="n">alpha</span><span class="si">}</span><span class="s1">)&#39;</span><span class="p">)</span>
    <span class="n">axs</span><span class="p">[</span><span class="n">i</span><span class="o">+</span><span class="mi">1</span><span class="p">]</span><span class="o">.</span><span class="n">axis</span><span class="p">(</span><span class="s1">&#39;off&#39;</span><span class="p">)</span>

<span class="n">plt</span><span class="o">.</span><span class="n">tight_layout</span><span class="p">()</span>
<span class="n">plt</span><span class="o">.</span><span class="n">show</span><span class="p">()</span>
</pre></div>
</div>
</section>
<section id="positive-and-negative-contributions">
<h3><a class="toc-backref" href="#id18" role="doc-backlink">Positive and Negative Contributions</a><a class="headerlink" href="#positive-and-negative-contributions" title="Link to this heading">ÔÉÅ</a></h3>
<div class="highlight-python notranslate"><div class="highlight"><pre><span></span><span class="c1"># Separate positive and negative contributions</span>
<span class="n">explanation</span> <span class="o">=</span> <span class="n">calculate_relevancemap</span><span class="p">(</span>
    <span class="n">model</span><span class="p">,</span>
    <span class="n">input_tensor</span><span class="p">,</span>
    <span class="n">method</span><span class="o">=</span><span class="s2">&quot;lrp_epsilon&quot;</span><span class="p">,</span>
    <span class="n">epsilon</span><span class="o">=</span><span class="mf">0.1</span>
<span class="p">)</span>

<span class="c1"># Extract positive and negative values</span>
<span class="n">explanation_flat</span> <span class="o">=</span> <span class="n">explanation</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span><span class="o">.</span><span class="n">sum</span><span class="p">(</span><span class="n">axis</span><span class="o">=</span><span class="mi">0</span><span class="p">)</span>
<span class="n">pos_explanation</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">maximum</span><span class="p">(</span><span class="mi">0</span><span class="p">,</span> <span class="n">explanation_flat</span><span class="p">)</span>
<span class="n">neg_explanation</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">minimum</span><span class="p">(</span><span class="mi">0</span><span class="p">,</span> <span class="n">explanation_flat</span><span class="p">)</span>

<span class="c1"># Normalize separately</span>
<span class="n">pos_norm</span> <span class="o">=</span> <span class="n">pos_explanation</span> <span class="o">/</span> <span class="n">np</span><span class="o">.</span><span class="n">max</span><span class="p">(</span><span class="n">pos_explanation</span><span class="p">)</span> <span class="k">if</span> <span class="n">np</span><span class="o">.</span><span class="n">max</span><span class="p">(</span><span class="n">pos_explanation</span><span class="p">)</span> <span class="o">&gt;</span> <span class="mi">0</span> <span class="k">else</span> <span class="n">pos_explanation</span>
<span class="n">neg_norm</span> <span class="o">=</span> <span class="n">neg_explanation</span> <span class="o">/</span> <span class="n">np</span><span class="o">.</span><span class="n">min</span><span class="p">(</span><span class="n">neg_explanation</span><span class="p">)</span> <span class="k">if</span> <span class="n">np</span><span class="o">.</span><span class="n">min</span><span class="p">(</span><span class="n">neg_explanation</span><span class="p">)</span> <span class="o">&lt;</span> <span class="mi">0</span> <span class="k">else</span> <span class="n">neg_explanation</span>

<span class="c1"># Visualize</span>
<span class="n">fig</span><span class="p">,</span> <span class="n">axs</span> <span class="o">=</span> <span class="n">plt</span><span class="o">.</span><span class="n">subplots</span><span class="p">(</span><span class="mi">1</span><span class="p">,</span> <span class="mi">4</span><span class="p">,</span> <span class="n">figsize</span><span class="o">=</span><span class="p">(</span><span class="mi">16</span><span class="p">,</span> <span class="mi">4</span><span class="p">))</span>

<span class="n">axs</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span><span class="o">.</span><span class="n">imshow</span><span class="p">(</span><span class="n">original_image</span><span class="p">)</span>
<span class="n">axs</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span><span class="o">.</span><span class="n">set_title</span><span class="p">(</span><span class="s1">&#39;Original Image&#39;</span><span class="p">)</span>
<span class="n">axs</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span><span class="o">.</span><span class="n">axis</span><span class="p">(</span><span class="s1">&#39;off&#39;</span><span class="p">)</span>

<span class="n">axs</span><span class="p">[</span><span class="mi">1</span><span class="p">]</span><span class="o">.</span><span class="n">imshow</span><span class="p">(</span><span class="n">normalize_relevance_map</span><span class="p">(</span><span class="n">explanation_flat</span><span class="p">),</span> <span class="n">cmap</span><span class="o">=</span><span class="s1">&#39;seismic&#39;</span><span class="p">,</span> <span class="n">clim</span><span class="o">=</span><span class="p">(</span><span class="o">-</span><span class="mi">1</span><span class="p">,</span> <span class="mi">1</span><span class="p">))</span>
<span class="n">axs</span><span class="p">[</span><span class="mi">1</span><span class="p">]</span><span class="o">.</span><span class="n">set_title</span><span class="p">(</span><span class="s1">&#39;Combined&#39;</span><span class="p">)</span>
<span class="n">axs</span><span class="p">[</span><span class="mi">1</span><span class="p">]</span><span class="o">.</span><span class="n">axis</span><span class="p">(</span><span class="s1">&#39;off&#39;</span><span class="p">)</span>

<span class="n">axs</span><span class="p">[</span><span class="mi">2</span><span class="p">]</span><span class="o">.</span><span class="n">imshow</span><span class="p">(</span><span class="n">pos_norm</span><span class="p">,</span> <span class="n">cmap</span><span class="o">=</span><span class="s1">&#39;Reds&#39;</span><span class="p">)</span>
<span class="n">axs</span><span class="p">[</span><span class="mi">2</span><span class="p">]</span><span class="o">.</span><span class="n">set_title</span><span class="p">(</span><span class="s1">&#39;Positive Contributions&#39;</span><span class="p">)</span>
<span class="n">axs</span><span class="p">[</span><span class="mi">2</span><span class="p">]</span><span class="o">.</span><span class="n">axis</span><span class="p">(</span><span class="s1">&#39;off&#39;</span><span class="p">)</span>

<span class="n">axs</span><span class="p">[</span><span class="mi">3</span><span class="p">]</span><span class="o">.</span><span class="n">imshow</span><span class="p">(</span><span class="o">-</span><span class="n">neg_norm</span><span class="p">,</span> <span class="n">cmap</span><span class="o">=</span><span class="s1">&#39;Blues&#39;</span><span class="p">)</span>
<span class="n">axs</span><span class="p">[</span><span class="mi">3</span><span class="p">]</span><span class="o">.</span><span class="n">set_title</span><span class="p">(</span><span class="s1">&#39;Negative Contributions&#39;</span><span class="p">)</span>
<span class="n">axs</span><span class="p">[</span><span class="mi">3</span><span class="p">]</span><span class="o">.</span><span class="n">axis</span><span class="p">(</span><span class="s1">&#39;off&#39;</span><span class="p">)</span>

<span class="n">plt</span><span class="o">.</span><span class="n">tight_layout</span><span class="p">()</span>
<span class="n">plt</span><span class="o">.</span><span class="n">show</span><span class="p">()</span>
</pre></div>
</div>
</section>
</section>
<section id="performance-optimization">
<h2><a class="toc-backref" href="#id19" role="doc-backlink">Performance Optimization</a><a class="headerlink" href="#performance-optimization" title="Link to this heading">ÔÉÅ</a></h2>
<p>For large models or datasets, consider these performance optimizations:</p>
<section id="tensorflow-performance">
<h3><a class="toc-backref" href="#id20" role="doc-backlink">TensorFlow Performance</a><a class="headerlink" href="#tensorflow-performance" title="Link to this heading">ÔÉÅ</a></h3>
<div class="highlight-python notranslate"><div class="highlight"><pre><span></span><span class="kn">import</span> <span class="nn">tensorflow</span> <span class="k">as</span> <span class="nn">tf</span>

<span class="c1"># Enable mixed precision (for TensorFlow 2.x with GPU)</span>
<span class="n">tf</span><span class="o">.</span><span class="n">keras</span><span class="o">.</span><span class="n">mixed_precision</span><span class="o">.</span><span class="n">set_global_policy</span><span class="p">(</span><span class="s1">&#39;mixed_float16&#39;</span><span class="p">)</span>

<span class="c1"># Use memory-efficient computation</span>
<span class="nd">@tf</span><span class="o">.</span><span class="n">function</span>
<span class="k">def</span> <span class="nf">compute_gradients</span><span class="p">(</span><span class="n">model</span><span class="p">,</span> <span class="n">inputs</span><span class="p">,</span> <span class="n">target_class</span><span class="p">):</span>
    <span class="k">with</span> <span class="n">tf</span><span class="o">.</span><span class="n">GradientTape</span><span class="p">()</span> <span class="k">as</span> <span class="n">tape</span><span class="p">:</span>
        <span class="n">tape</span><span class="o">.</span><span class="n">watch</span><span class="p">(</span><span class="n">inputs</span><span class="p">)</span>
        <span class="n">predictions</span> <span class="o">=</span> <span class="n">model</span><span class="p">(</span><span class="n">inputs</span><span class="p">)</span>
        <span class="n">loss</span> <span class="o">=</span> <span class="n">predictions</span><span class="p">[:,</span> <span class="n">target_class</span><span class="p">]</span>
    <span class="k">return</span> <span class="n">tape</span><span class="o">.</span><span class="n">gradient</span><span class="p">(</span><span class="n">loss</span><span class="p">,</span> <span class="n">inputs</span><span class="p">)</span>

<span class="c1"># Batch processing</span>
<span class="k">def</span> <span class="nf">process_large_dataset</span><span class="p">(</span><span class="n">model</span><span class="p">,</span> <span class="n">dataset</span><span class="p">,</span> <span class="n">batch_size</span><span class="o">=</span><span class="mi">32</span><span class="p">):</span>
    <span class="n">all_explanations</span> <span class="o">=</span> <span class="p">[]</span>

    <span class="k">for</span> <span class="n">batch</span> <span class="ow">in</span> <span class="n">dataset</span><span class="o">.</span><span class="n">batch</span><span class="p">(</span><span class="n">batch_size</span><span class="p">):</span>
        <span class="n">batch_explanations</span> <span class="o">=</span> <span class="n">calculate_relevancemap</span><span class="p">(</span><span class="s1">&#39;gradient_x_input&#39;</span><span class="p">,</span> <span class="n">batch</span><span class="p">,</span> <span class="n">model</span><span class="p">)</span>
        <span class="n">all_explanations</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">batch_explanations</span><span class="p">)</span>

    <span class="k">return</span> <span class="n">np</span><span class="o">.</span><span class="n">concatenate</span><span class="p">(</span><span class="n">all_explanations</span><span class="p">,</span> <span class="n">axis</span><span class="o">=</span><span class="mi">0</span><span class="p">)</span>
</pre></div>
</div>
</section>
<section id="pytorch-performance">
<h3><a class="toc-backref" href="#id21" role="doc-backlink">PyTorch Performance</a><a class="headerlink" href="#pytorch-performance" title="Link to this heading">ÔÉÅ</a></h3>
<div class="highlight-python notranslate"><div class="highlight"><pre><span></span><span class="kn">import</span> <span class="nn">torch</span>

<span class="c1"># Enable mixed precision</span>
<span class="n">scaler</span> <span class="o">=</span> <span class="n">torch</span><span class="o">.</span><span class="n">cuda</span><span class="o">.</span><span class="n">amp</span><span class="o">.</span><span class="n">GradScaler</span><span class="p">()</span>

<span class="c1"># Memory-efficient computation</span>
<span class="k">def</span> <span class="nf">efficient_gradient</span><span class="p">(</span><span class="n">model</span><span class="p">,</span> <span class="n">inputs</span><span class="p">,</span> <span class="n">target_class</span><span class="p">):</span>
    <span class="n">inputs</span> <span class="o">=</span> <span class="n">inputs</span><span class="o">.</span><span class="n">to</span><span class="p">(</span><span class="s1">&#39;cuda&#39;</span><span class="p">)</span>
    <span class="n">model</span> <span class="o">=</span> <span class="n">model</span><span class="o">.</span><span class="n">to</span><span class="p">(</span><span class="s1">&#39;cuda&#39;</span><span class="p">)</span>

    <span class="n">inputs</span><span class="o">.</span><span class="n">requires_grad</span> <span class="o">=</span> <span class="kc">True</span>

    <span class="k">with</span> <span class="n">torch</span><span class="o">.</span><span class="n">cuda</span><span class="o">.</span><span class="n">amp</span><span class="o">.</span><span class="n">autocast</span><span class="p">():</span>
        <span class="n">outputs</span> <span class="o">=</span> <span class="n">model</span><span class="p">(</span><span class="n">inputs</span><span class="p">)</span>

        <span class="c1"># One-hot encoding</span>
        <span class="n">one_hot</span> <span class="o">=</span> <span class="n">torch</span><span class="o">.</span><span class="n">zeros_like</span><span class="p">(</span><span class="n">outputs</span><span class="p">)</span>
        <span class="n">one_hot</span><span class="p">[:,</span> <span class="n">target_class</span><span class="p">]</span> <span class="o">=</span> <span class="mi">1</span>

    <span class="c1"># Compute gradients</span>
    <span class="n">model</span><span class="o">.</span><span class="n">zero_grad</span><span class="p">()</span>
    <span class="n">outputs</span><span class="o">.</span><span class="n">backward</span><span class="p">(</span><span class="n">gradient</span><span class="o">=</span><span class="n">one_hot</span><span class="p">)</span>

    <span class="k">return</span> <span class="n">inputs</span><span class="o">.</span><span class="n">grad</span><span class="o">.</span><span class="n">detach</span><span class="p">()</span><span class="o">.</span><span class="n">cpu</span><span class="p">()</span>

<span class="c1"># Batch processing with DataLoader</span>
<span class="k">def</span> <span class="nf">process_large_dataset</span><span class="p">(</span><span class="n">model</span><span class="p">,</span> <span class="n">dataset_loader</span><span class="p">):</span>
    <span class="n">all_explanations</span> <span class="o">=</span> <span class="p">[]</span>

    <span class="k">for</span> <span class="n">batch</span> <span class="ow">in</span> <span class="n">dataset_loader</span><span class="p">:</span>
        <span class="n">inputs</span><span class="p">,</span> <span class="n">_</span> <span class="o">=</span> <span class="n">batch</span>
        <span class="n">explanations</span> <span class="o">=</span> <span class="n">calculate_relevancemap</span><span class="p">(</span><span class="n">model</span><span class="p">,</span> <span class="n">inputs</span><span class="p">,</span> <span class="n">method</span><span class="o">=</span><span class="s2">&quot;gradients&quot;</span><span class="p">)</span>
        <span class="n">all_explanations</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">explanations</span><span class="p">)</span>

    <span class="k">return</span> <span class="n">np</span><span class="o">.</span><span class="n">concatenate</span><span class="p">(</span><span class="n">all_explanations</span><span class="p">,</span> <span class="n">axis</span><span class="o">=</span><span class="mi">0</span><span class="p">)</span>
</pre></div>
</div>
</section>
</section>
<section id="next-steps">
<h2><a class="toc-backref" href="#id22" role="doc-backlink">Next Steps</a><a class="headerlink" href="#next-steps" title="Link to this heading">ÔÉÅ</a></h2>
<p>After exploring these advanced techniques, you may want to:</p>
<ol class="arabic simple">
<li><p>Read about the specific implementation details in <a class="reference internal" href="tensorflow.html"><span class="doc">TensorFlow Implementation</span></a> and <a class="reference internal" href="pytorch.html"><span class="doc">PyTorch Implementation</span></a></p></li>
<li><p>Learn how to convert models between frameworks in <a class="reference internal" href="framework_interop.html"><span class="doc">Framework Interoperability</span></a></p></li>
<li><p>Explore the complete API reference in <a class="reference internal" href="../api/common.html"><span class="doc">Common Module</span></a>, <a class="reference internal" href="../api/tensorflow.html"><span class="doc">TensorFlow Module</span></a>, and <a class="reference internal" href="../api/pytorch.html"><span class="doc">PyTorch Module</span></a></p></li>
</ol>
</section>
</section>


           </div>
          </div>
          <footer><div class="rst-footer-buttons" role="navigation" aria-label="Footer">
        <a href="framework_interop.html" class="btn btn-neutral float-left" title="Framework Interoperability" accesskey="p" rel="prev"><span class="fa fa-arrow-circle-left" aria-hidden="true"></span> Previous</a>
        <a href="visualization.html" class="btn btn-neutral float-right" title="Visualization" accesskey="n" rel="next">Next <span class="fa fa-arrow-circle-right" aria-hidden="true"></span></a>
    </div>

  <hr/>

  <div role="contentinfo">
    <p>&#169; Copyright 2024, SignXAI Team.</p>
  </div>

  Built with <a href="https://www.sphinx-doc.org/">Sphinx</a> using a
    <a href="https://github.com/readthedocs/sphinx_rtd_theme">theme</a>
    provided by <a href="https://readthedocs.org">Read the Docs</a>.
   

</footer>
        </div>
      </div>
    </section>
  </div>
  <script>
      jQuery(function () {
          SphinxRtdTheme.Navigation.enable(true);
      });
  </script> 

</body>
</html>